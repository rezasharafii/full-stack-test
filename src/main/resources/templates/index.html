<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:hx-on="http://www.w3.org/1999/xhtml"
      th:replace="~{layout :: layout(~{::body})}">
<body>

<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--wa-space-l);">
        <h3 style="margin: 0;">Product List</h3>
        <wa-button
                variant="neutral"
                hx-get="/products"
                hx-target="#product-table"
                hx-swap="innerHTML"
                hx-vals='js:{page: 1, size: 10}'
                hx-on:htmx:after:request="document.getElementById('form-container').style.display = 'block'">

            <wa-icon slot="prefix" name="plus"></wa-icon>
            Load Products
        </wa-button>
    </div>

    <div id="product-table"
         style=" border-radius: var(--wa-border-radius-m); box-shadow: var(--wa-shadow-l) ">
        <p style="color: var(--wa-color-neutral-50); text-align: center; padding: var(--wa-space-xl);">
            No products loaded. Click "Load Products" to begin.
        </p>
    </div>
    <div id="form-container" style="display: none;">

        <section class="card"
                 style="margin-top: var(--wa-space-l); padding: var(--wa-space-xl); background-color: var(--wa-color-neutral-95);">
            <h3 style="margin-top: 0; margin-bottom: var(--wa-space-l); font-size: var(--wa-font-size-xl);">Add
                Product</h3>

            <form hx-post="/products"
                  hx-target="#product-table"
                  hx-swap="innerHTML"
                  hx-on:htmx:after:request="
        if(event.detail.ctx.response.status == 200 && event.detail.ctx.request.action === '/products') {
            this.reset();
            document.getElementById('variants').innerHTML = '';
            showToast('Product added successfully!', 'success');
        }"
                  style="display: flex; flex-direction: column; gap: var(--wa-space-l);">

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--wa-space-m);">
                    <wa-input name="title" label="Product Title" placeholder="e.g. Wireless Mouse" required
                              style="grid-column: span 2;"></wa-input>
                    <wa-input name="vendor" label="Vendor" placeholder="Brand name"></wa-input>
                    <wa-input name="productType" label="Type" placeholder="Category"></wa-input>
                </div>

                <div style="border-top: 1px solid var(--wa-color-neutral-80); padding-top: var(--wa-space-l);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--wa-space-m);">
                        <h4 style="margin: 0; color: var(--wa-color-neutral-30);">Variants</h4>
                        <wa-button th:type="button"
                                   variant="neutral"
                                   size="small"
                                   appearance="filled-outlined"
                                   hx-get="/products/variant-row"
                                   hx-target="#variants"
                                   hx-swap="beforeend"
                                   hx-vals='js:{index: document.querySelectorAll(".variant-row").length}'>

                            <wa-icon name="plus"></wa-icon>
                            Add Variant
                        </wa-button>
                    </div>

                    <div id="variants" style="display: flex; flex-direction: column; gap: var(--wa-space-s);">
                    </div>
                </div>

                <div style="margin-top: var(--wa-space-m); border-top: 1px solid var(--wa-color-neutral-80); padding-top: var(--wa-space-l);">
                    <wa-button variant="success" style="width: fit-content" th:type="submit"
                    >
                        <wa-icon slot="prefix" name="check"></wa-icon>
                        Save Product
                    </wa-button>
                </div>
            </form>
        </section>
    </div>
</div>
</body>
</html>
